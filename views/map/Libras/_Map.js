define(["Libras","./others/CircleBuilder","./layers/GraphicsLayer","./Ground"],function(e,i,r,t){var a=e.AssociativeArray,n=e.VerticalOrigin,s=e.knockout,o=e.Color,l=e.Check,c=e.GeoJsonDataSource,d=e.Libras3DTileset,v=e.WebMapServiceImageryProvider,m=e.WebMapTileServiceImageryProvider,f=e.RuntimeError,y=e.GroundPrimitive,u=e.LSPageLOD;function g(e){this.viewer=e,this.allLayers=new a,this.basemap=new a,this.ground=new t(e),this.layers=new a}return g.prototype.add=function(t,a){var g=this;if(l.typeOf.object("layer",t),t instanceof e.LSPageLOD&&(this.viewer.scene.requestRenderMode=!1),t.id&&this.layers.contains(t.id))throw new f("A Graphic with id "+t.id+"already exist in this collection");if(!t.then){if(t instanceof r)w=g.viewer.entities;else if(t instanceof d)g.viewer.scene.primitives.add(t);else if(t instanceof v){let e=t.id;(t=g.viewer.imageryLayers.addImageryProvider(t)).id=e}else if(t instanceof m){var h=t.id;(t=g.viewer.imageryLayers.addImageryProvider(t)).id=h}else if(t instanceof e.UrlTemplateImageryProvider){h=t.id;(t=g.viewer.imageryLayers.addImageryProvider(t)).id=h}else t instanceof y?t=g.viewer.scene.primitives.add(t):t instanceof u?t=g.viewer.scene.primitives.add(t):w=g.viewer.scene.primitives;g.layers.set(t.id,t),t.viewer=this.viewer;var w,L=t.items;return L instanceof Array&&L.forEach(function(e,i,r){w.add(e)}),this.viewer.scene.requestRender(),t}t.then(function(e){if(e instanceof c){if(g.viewer.dataSources.add(e),e.entities._entities._array.forEach(function(e,i,r){e.point={pixelSize:10,color:o.RED},e.billboard=null}),t.featureReduction){var r;e.clustering.enabled=!0,e.clustering.pixelRange=15,e.clustering.minimumClusterSize=3;for(var a=new i,l=a.fromText("50+",o.RED,48).toDataURL(),d=a.fromText("40+",o.ORANGE,48).toDataURL(),v=a.fromText("30+",o.YELLOW,48).toDataURL(),m=a.fromText("20+",o.GREEN,48).toDataURL(),f=a.fromText("10+",o.BLUE,48).toDataURL(),y=new Array(8),u=0;u<y.length;++u)y[u]=a.fromText(""+(u+2),o.VIOLET,48).toDataURL();!function(){r?(r(),r=void 0):r=e.clustering.clusterEvent.addEventListener(function(e,i){i.label.show=!1,i.billboard.show=!0,i.billboard.id=i.label.id,i.billboard.verticalOrigin=n.BOTTOM,e.length>=50?i.billboard.image=l:e.length>=40?i.billboard.image=d:e.length>=30?i.billboard.image=v:e.length>=20?i.billboard.image=m:e.length>=10&&(i.billboard.image=f)});var i=e.clustering.pixelRange;e.clustering.pixelRange=0,e.clustering.pixelRange=i}();var h={pixelRange:pixelRange,minimumClusterSize:minimumClusterSize};function w(i){s.getObservable(h,i).subscribe(function(r){e.clustering[i]=r})}s.track(h),w("pixelRange"),w("minimumClusterSize")}return e.id=t.id,g.layers.set(e.id,e),e.viewer=g.viewer,e}})},g.prototype.remove=function(i){if(!i||"object"!=typeof i)return!1;var t;i instanceof r?t=this.viewer.entities:i instanceof c?this.viewer.dataSources.remove(i):i instanceof d?this.viewer.scene.primitives.remove(i):i instanceof v?this.viewer.imageryLayers.remove(this.findLayerById(i.id)):i instanceof e.ImageryLayer?this.viewer.imageryLayers.remove(this.findLayerById(i.id)):i instanceof e.UrlTemplateImageryProvider?this.viewer.imageryLayers.remove(this.findLayerById(i.id)):i instanceof y?this.viewer.scene.primitives.remove(i):i instanceof u?this.viewer.scene.primitives.remove(i):i instanceof e.ImageryLayer?this.viewer.imageryLayers.remove(i):t=this.viewer.scene.primitives,t&&i.items.forEach(function(e,i,r){t.remove(e)}),this.viewer.scene.requestRender();let a=this.layers.remove(i.id);return this.viewer.scene.requestRenderMode=!this.layers._array.length||this.layers._array.some(function(i,r,t){return i instanceof e.LSPageLOD}),console.log(this.layers._array.some(function(i,r,t){return i instanceof e.LSPageLOD})),a},g.prototype.findLayerById=function(e){return this.layers.get(e)},g});