define(["../layers/GraphicsLayer","../others/EventDrive","../symbols/TextSymbol","../symbols/PrimitiveSymbol","../Graphic","../_Color","Libras"],function(e,i,t,s,o,l,r){function h(t){this.viewer=t.viewer,this.layer=new e,this.circles=[],this.path=[],this.height=[],this.lines=null,this.label=[],this.point=this.viewer.entities.add({point:{color:r.Color.RED,pixelSize:10}}),this.labelTotle=this.viewer.entities.add({label:{show:!1,showBackground:!0,font:"36px Helvetica",fillColor:l("WHITE"),outlineColor:l("BACK"),outlineWidth:5,style:r.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.BASELINE,disableDepthTestDistance:1e4,scale:.5}}),this.event=new i({viewer:this.viewer,eventType:"left_click",callBack:e=>{let i=this.path,t=this.movePoint.mapPoint.longitude,h=this.movePoint.mapPoint.latitude,n=this.movePoint.mapPoint.height,a=0,c=0;if(n<-50)return;i.push(t,h),this.height.push(n);let p=i.length,v=new o({symbol:{type:"point-3d",style:{type:"cone",height:60,width:30,color:"#4af99d"}},geometry:{type:"point",longitude:t,latitude:h,height:n+30}}),d=new s({type:"circle",center:[t,h],radius:.5,color:"#4af99d",class:"both"}),w=new s({type:"line",ranges:i,color:"red",width:1,class:"both"});if(this.layer.add(v),this.viewer.map.remove(this.lines),this.circles.push(d),this.lines=w,this.viewer.map.add(w),this.viewer.map.add(d),p>=4){for(let e=p-1;e>=3;e-=2)a+=Math.sqrt(r.Cartesian3.distanceSquared(new r.Cartesian3.fromDegrees(i[e-1],i[e]),new r.Cartesian3.fromDegrees(i[e-3],i[e-2])));c=Math.sqrt(r.Cartesian3.distanceSquared(new r.Cartesian3.fromDegrees(i[p-2],i[p-1]),new r.Cartesian3.fromDegrees(i[p-4],i[p-3]))),this.labelTotle.position=new r.Cartesian3.fromDegrees(i[0],i[1],this.height[0]+10),this.labelTotle.show=!0,this.labelTotle.label.show=!0,this.labelTotle.label.text="总长:"+a.toFixed(2)+"米";let e=this.viewer.entities.add({show:!0,position:new r.Cartesian3.fromDegrees((i[p-2]+i[p-4])/2,(i[p-1]+i[p-3])/2,this.height[p/2-1]+10),label:{show:!0,text:c.toFixed(2)+"米",showBackground:!0,font:"36px Helvetica",fillColor:l("WHITE"),outlineColor:l("BACK"),outlineWidth:5,style:r.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:r.HorizontalOrigin.CENTER,verticalOrigin:r.VerticalOrigin.BASELINE,disableDepthTestDistance:1e4,scale:.5}});this.label.push(e)}this.viewer.scene.requestRenderMode=!1}}),this.mouseMove=new i({eventType:"mouse_move",viewer:t.viewer,callBack:e=>{this.movePoint=e,this.point&&(this.point.position=e.cartesian)}})}return h.prototype.destroy=function(){this.viewer.entities.remove(this.labelTotle),this.viewer.entities.remove(this.point),this.label.forEach(e=>this.viewer.entities.remove(e)),this.viewer.map.remove(this.lines),this.circles.forEach(e=>this.viewer.map.remove(e)),this.event.destroy(),this.mouseMove.destroy(),this.height=[],this.circles=[],this.point=null,this.path=[],this.lines=null},h});