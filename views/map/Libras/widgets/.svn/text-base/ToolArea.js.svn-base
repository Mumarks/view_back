define(["../layers/GraphicsLayer","../others/EventDrive","../symbols/TextSymbol","../symbols/PrimitiveSymbol","../Graphic","../_Color","Libras"],function(e,i,t,s,o,r,l){function n(t){this.viewer=t.viewer,this.layer=new e,this.circles=[],this.path=[],this.height=[],this.lines=null,this.label=[],this.point=this.viewer.entities.add({point:{color:l.Color.RED,pixelSize:10}}),this.labelTotle=this.viewer.entities.add({label:{show:!1,showBackground:!0,font:"36px Helvetica",fillColor:r("WHITE"),outlineColor:r("BACK"),outlineWidth:5,style:l.LabelStyle.FILL_AND_OUTLINE,horizontalOrigin:l.HorizontalOrigin.CENTER,verticalOrigin:l.VerticalOrigin.BASELINE,disableDepthTestDistance:1e4,scale:.5}}),this.event=new i({viewer:this.viewer,eventType:"left_click",callBack:e=>{let i=this.path,t=this.movePoint.mapPoint.longitude,r=this.movePoint.mapPoint.latitude,n=this.movePoint.mapPoint.height;if(n<-50)return;i.push(t,r),this.height.push(n);let h=i.length,a=new o({symbol:{type:"point-3d",style:{type:"cone",height:60,width:30,color:"#4af99d"}},geometry:{type:"point",longitude:t,latitude:r,height:n+30}}),v=new s({type:"circle",center:[t,r],radius:.5,color:"#4af99d",class:"both"}),c=new s({type:i.length>4?"":"line",ranges:i,color:"rgba(255, 0, 0, .8)",width:1,class:"both"});if(this.layer.add(a),this.lines&&this.viewer.map.remove(this.lines),this.lines=c,this.circles.push(v),this.viewer.map.add(c),this.viewer.map.add(v),h>=6){var p=new l.PolygonGeometry({polygonHierarchy:new l.PolygonHierarchy(l.Cartesian3.fromDegreesArray(i)),perPositionHeight:!0}),y=l.PolygonGeometry.createGeometry(p);if(void 0!=y){for(var m=y.indices,d=y.attributes.position.values,w=[],u=0,g=0;g<d.length/3;g++){var b=new l.Cartesian3(0,0,0);b.x=d[3*g],b.y=d[3*g+1],b.z=d[3*g+2],w.push(b)}for(g=0;g<m.length/3;g++){var f=[];f.push(w[m[3*g]],w[m[3*g+1]],w[m[3*g+2]]);var T=l.Cartesian3.distance(f[0],f[1]),C=l.Cartesian3.distance(f[0],f[2]),P=l.Cartesian3.distance(f[1],f[2]),E=(T+C+P)/2;u+=Math.sqrt(E*(E-T)*(E-P)*(E-C))}let e=this.layer.items.map(function(e,i,t){return e.position._value});var x=0,D=0,L=0;for(g=0;g<e.length;g++)x+=e[g].x,D+=e[g].y,L+=e[g].z;var z=e.length,H=new l.Cartesian3.fromDegrees(0,0,0);H.x=x/z,H.y=D/z,H.z=L/z,this.labelTotle.position=H,this.labelTotle.show=!0,this.labelTotle.label.show=!0,this.labelTotle.label.text="总面积:"+u.toFixed(2)+"m²"}}this.viewer.scene.requestRenderMode=!1}}),this.mouseMove=new i({eventType:"mouse_move",viewer:t.viewer,callBack:e=>{this.movePoint=e,this.point&&(this.point.position=e.cartesian)}})}return n.prototype.destroy=function(){this.viewer.entities.remove(this.labelTotle),this.viewer.entities.remove(this.point),this.label.forEach(e=>this.viewer.entities.remove(e)),this.circles.forEach(e=>this.viewer.map.remove(e)),this.viewer.map.remove(this.lines),this.event.destroy(),this.mouseMove.destroy(),this.height=[],this.circles=[],this.point=null,this.path=[],this.lines=null},n});